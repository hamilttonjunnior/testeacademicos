<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acad√™micos - Gest√£o de Jogos</title>
    <style>
        :root { --primary: #1a2a3a; --accent: #3498db; --error: #e74c3c; --success: #27ae60; --bg: #f4f7f9; --finished: #bdc3c7; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; min-height: 100vh; }
        
        #loginScreen { position: fixed; inset: 0; background: var(--primary); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .login-box { background: white; padding: 40px; border-radius: 12px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); width: 320px; }
        .login-logo { max-width: 150px; margin-bottom: 20px; display: block; margin-left: auto; margin-right: auto; }
        .login-box input, .login-box button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; box-sizing: border-box; }
        .login-box input { border: 1px solid #ddd; }
        .login-box button { background: var(--accent); color: white; border: none; cursor: pointer; font-weight: bold; }
        
        .main-content { width: 95%; max-width: 1200px; margin: 20px auto; display: none; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; }
        
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        .header-logo { max-height: 50px; margin-right: 15px; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent); text-align: center; }
        .stat-card h3 { margin: 0; font-size: 12px; color: #666; text-transform: uppercase; }
        .stat-card p { margin: 5px 0 0; font-size: 20px; font-weight: bold; color: var(--primary); }
        
        .form-grid, .filter-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; background: #fafafa; padding: 20px; border-radius: 8px; border: 1px solid #eaeaea; margin-bottom: 20px; }
        .filter-grid { background: #eef2f7; border-color: #d1d9e6; }
        .field { display: flex; flex-direction: column; gap: 5px; }
        .field label { font-size: 12px; font-weight: bold; color: #666; }
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
        .btn-marcar { grid-column: 1 / -1; padding: 15px; background: var(--success); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .btn-export { background: #55acee; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6; }
        td { padding: 15px; border-bottom: 1px solid #eee; }
        
        .row-conflito { background-color: #fff5f5 !important; }
        .row-finalizado { background-color: #f2f4f5 !important; color: #7f8c8d !important; font-size: 13px; }
        
        .badge { padding: 5px 10px; border-radius: 4px; font-size: 11px; font-weight: 800; }
        .badge-casa { background: #d1ecf1; color: #0c5460; }
        .badge-fora { background: #e2e3e5; color: #383d41; }
        .badge-finalizado { background: #bdc3c7; color: white; }
        
        .btn-action { background: none; border: 1px solid #ddd; padding: 5px 8px; border-radius: 4px; cursor: pointer; margin-right: 5px; }
        .btn-finalizar { background: var(--accent); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold; }
        
        .resultado-tag { font-weight: bold; color: var(--primary); font-size: 14px; display: block; margin-top: 4px; }
        .parciais-tag { font-size: 11px; color: #7f8c8d; font-style: italic; }
        .secao-titulo { margin: 40px 0 15px 0; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .error-tag { color: var(--error); font-size: 11px; display: block; font-weight: bold; }

        @media print { .login-box, .form-grid, .filter-grid, .btn-action, .btn-finalizar, header button { display: none !important; } }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <img src="academicos.png" alt="Logo" class="login-logo">
        <input type="text" id="userIn" placeholder="Usu√°rio">
        <input type="password" id="passIn" placeholder="Senha">
        <button onclick="checkLogin()">Entrar</button>
    </div>
</div>

<div class="main-content" id="app">
    <div class="container">
        <header>
            <div style="display: flex; align-items: center;">
                <img src="academicos.png" alt="Logo" class="header-logo">
                <h2 style="margin:0;">Gest√£o de Jogos - FC Acad√©micos</h2>
            </div>
            <button onclick="location.reload()" style="cursor:pointer;">Sair</button>
        </header>

        <div class="stats-grid">
            <div class="stat-card"><h3>Total Jogos</h3><p id="statTotal">0</p></div>
            <div class="stat-card"><h3>Em Casa</h3><p id="statCasa">0</p></div>
            <div class="stat-card"><h3>Fora</h3><p id="statFora">0</p></div>
            <div class="stat-card"><h3>Finalizados</h3><p id="statFim">0</p></div>
        </div>

        <div class="form-grid">
            <div class="field"><label>Treinador</label>
                <select id="treinador">
                    <option value="">Selecione...</option>
                    <option value="Jorge Torres">Jorge Torres</option>
                    <option value="Amanda Gonz√°lez">Amanda Gonz√°lez</option>
                    <option value="Pedro Carvalho">Pedro Carvalho</option>
                    <option value="In√™s Ferreira">In√™s Ferreira</option>
                    <option value="Hamilton J√∫nior">Hamilton J√∫nior</option>
                    <option value="Ricardo Pereira">Ricardo Pereira</option>
                    <option value="Ricardo Magno">Ricardo Magno</option>
                    <option value="Pedro Pavezzi">Pedro Pavezzi</option>
                    <option value="Carlos Louro">Carlos Louro</option>
                    <option value="Cristina Cortez">Cristina Cortez</option>
                    <option value="Bruno Pereira">Bruno Pereira</option>
                    <option value="Pablo Romero">Pablo Romero</option>
                    <option value="H√©lder Serr√£o">H√©lder Serr√£o</option>
                    <option value="Carlos Martins">Carlos Martins</option>
                </select>
            </div>
            <div class="field"><label>Cor</label><input type="color" id="cor" value="#3498db"></div>
            <div class="field"><label>Localiza√ß√£o</label><select id="casaFora"><option value="Casa">Casa üè†</option><option value="Fora">Fora üöå</option></select></div>
            <div class="field"><label>Data</label><input type="date" id="data"></div>
            <div class="field"><label>Hora</label><input type="time" id="hora"></div>
            <div class="field"><label>Competi√ß√£o</label><input type="text" id="competicao" placeholder="Ex: Regional"></div>
            <div class="field"><label>Jornada</label><input type="text" id="jornada" placeholder="Ex: 1¬™"></div>
            <div class="field"><label>N¬∫ Jogo</label><input type="number" id="numJogo" placeholder="Ex: 1024"></div>
            <div class="field"><label>Escal√£o</label>
                <select id="escalao">
                    <option value="">Selecione...</option>
                    <option value="Infantis A Fem">Infantis A Fem</option>
                    <option value="Infantis B Fem">Infantis B Fem</option>
                    <option value="Infantis C Fem">Infantis C Fem</option>
                    <option value="Iniciados A Fem">Iniciados A Fem</option>
                    <option value="Iniciados B Fem">Iniciados B Fem</option>
                    <option value="Iniciados Masc">Iniciados Masc</option>
                    <option value="Cadetes Fem">Cadetes Fem</option>
                    <option value="Cadetes Masc">Cadetes Masc</option>
                    <option value="Juvenis A Fem">Juvenis A Fem</option>
                    <option value="Juvenis B Fem">Juvenis B Fem</option>
                    <option value="Juvenis Masc">Juvenis Masc</option>
                    <option value="Sub21 Fem">Sub21 Fem</option>
                    <option value="S√©niores Fem">S√©niores Fem</option>
                    <option value="S√©niores Masc">S√©niores Masc</option>
                    <option value="Veteranos +35 Masc">Veteranos +35 Masc</option>
                    <option value="Veteranos +45 Masc">Veteranos +45 Masc</option>
                </select>
            </div>
            <div class="field"><label>Advers√°rio</label><input type="text" id="adversario"></div>
            <div class="field"><label>Pavilh√£o</label><input type="text" id="pavilhao"></div>
            
            <div class="field" id="boxSetPro" style="display:none;"><label>Sets Pr√≥ (Acad√©micos)</label><input type="number" id="setPro" value="0"></div>
            <div class="field" id="boxSetContra" style="display:none;"><label>Sets Contra</label><input type="number" id="setContra" value="0"></div>
            <div class="field" id="boxParciais" style="display:none; grid-column: 1 / -1;"><label>Parciais (ex: 25-10, 25-15, 25-20)</label><input type="text" id="parciais"></div>

            <button class="btn-marcar" id="btnSalvar" onclick="salvarJogo()">AGENDAR / ATUALIZAR JOGO</button>
        </div>

        <div class="filter-grid">
            <div class="field"><label>üîç Filtrar Treinador</label><select id="filterTreinador" onchange="render()"><option value="">Todos</option></select></div>
            <div class="field"><label>üîç Filtrar Escal√£o</label><select id="filterEscalao" onchange="render()"><option value="">Todos</option></select></div>
            <div style="display: flex; align-items: flex-end;"><button class="btn-export" onclick="window.print()">üñ®Ô∏è Exportar / PDF</button></div>
        </div>

        <h3 class="secao-titulo">üèê Pr√≥ximos Jogos</h3>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr><th></th><th>Treinador</th><th>Competi√ß√£o</th><th>Jornada</th><th>N¬∫ Jogo</th><th>Escal√£o</th><th>Advers√°rio</th><th>Data/Hora</th><th>Pavilh√£o</th><th>Tipo</th><th>A√ß√µes</th></tr>
                </thead>
                <tbody id="lista"></tbody>
            </table>
        </div>

        <h3 class="secao-titulo">üìú Hist√≥rico de Jogos Finalizados</h3>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr><th></th><th>Treinador</th><th>Competi√ß√£o</th><th>Jornada</th><th>N¬∫ Jogo</th><th>Escal√£o</th><th>Advers√°rio / Resultado</th><th>Data/Hora</th><th>Pavilh√£o</th><th>Status</th><th>A√ß√µes</th></tr>
                </thead>
                <tbody id="listaHistorico"></tbody>
            </table>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyB86TeZnp2qdOXXwjvD3hFfzTi3Z3NkVMc",
        authDomain: "academicos-d2cfc.firebaseapp.com",
        projectId: "academicos-d2cfc",
        storageBucket: "academicos-d2cfc.firebasestorage.app",
        messagingSenderId: "550824625713",
        appId: "1:550824625713:web:f3194f8e4f06dc141a3710"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const jogosCol = collection(db, "jogos");

    let jogosAtuais = [];
    let editId = null;

    window.checkLogin = () => {
        if(document.getElementById('userIn').value === 'academicos' && document.getElementById('passIn').value === 'academicos2026') {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            carregarJogos();
            popularFiltros();
        } else { alert("Senha incorreta!"); }
    };

    function popularFiltros() {
        const tSel = document.getElementById('treinador').innerHTML;
        const eSel = document.getElementById('escalao').innerHTML;
        document.getElementById('filterTreinador').innerHTML = '<option value="">Todos os Treinadores</option>' + tSel;
        document.getElementById('filterEscalao').innerHTML = '<option value="">Todos os Escal√µes</option>' + eSel;
    }

    window.salvarJogo = async () => {
        const btn = document.getElementById('btnSalvar');
        btn.disabled = true;
        const dados = {
            treinador: document.getElementById('treinador').value,
            cor: document.getElementById('cor').value,
            casaFora: document.getElementById('casaFora').value,
            data: document.getElementById('data').value,
            hora: document.getElementById('hora').value,
            competicao: document.getElementById('competicao').value,
            jornada: document.getElementById('jornada').value,
            numJogo: document.getElementById('numJogo').value,
            escalao: document.getElementById('escalao').value,
            adversario: document.getElementById('adversario').value,
            pavilhao: document.getElementById('pavilhao').value,
            setPro: document.getElementById('setPro').value || 0,
            setContra: document.getElementById('setContra').value || 0,
            parciais: document.getElementById('parciais').value || '',
            finalizado: editId ? (jogosAtuais.find(x => x.id === editId).finalizado || false) : false
        };

        try {
            if(editId) { await updateDoc(doc(db, "jogos", editId), dados); editId = null; }
            else { await addDoc(jogosCol, dados); }
            limpar();
        } catch (e) { alert("Erro ao salvar!"); }
        btn.disabled = false;
        document.getElementById('boxSetPro').style.display = 'none';
        document.getElementById('boxSetContra').style.display = 'none';
        document.getElementById('boxParciais').style.display = 'none';
    };

    window.finalizarJogoPrompt = (id) => {
        if (prompt("Digite a senha para finalizar:") === "academicos2026") {
            const sp = prompt("Sets Pr√≥ (Acad√©micos):", "0");
            const sc = prompt("Sets Contra:", "0");
            const pa = prompt("Parciais (ex: 25-10, 25-20):", "");
            updateDoc(doc(db, "jogos", id), { finalizado: true, setPro: sp, setContra: sc, parciais: pa });
        }
    };

    function carregarJogos() {
        const q = query(jogosCol, orderBy("data"), orderBy("hora"));
        onSnapshot(q, (snapshot) => {
            jogosAtuais = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            render();
        });
    }

    window.render = () => {
        const lista = document.getElementById('lista');
        const listaHistorico = document.getElementById('listaHistorico');
        const fTreinador = document.getElementById('filterTreinador').value;
        const fEscalao = document.getElementById('filterEscalao').value;
        
        lista.innerHTML = '';
        listaHistorico.innerHTML = '';
        const agora = new Date();
        let cCasa = 0, cFora = 0, cFim = 0;

        // Reset conflitos
        jogosAtuais.forEach(j => j.conflito = false);
        for (let i = 0; i < jogosAtuais.length; i++) {
            for (let j = i + 1; j < jogosAtuais.length; j++) {
                let a = jogosAtuais[i], b = jogosAtuais[j];
                if(!a.finalizado && !b.finalizado && a.casaFora === 'Casa' && b.casaFora === 'Casa' && a.data && b.data && a.data === b.data) {
                    let diff = Math.abs(new Date(a.data+'T'+a.hora) - new Date(b.data+'T'+b.hora)) / 60000;
                    if(diff < 120) { a.conflito = true; b.conflito = true; }
                }
            }
        }

        const finalizados = jogosAtuais.filter(j => j.finalizado).reverse();
        const ativos = jogosAtuais.filter(j => !j.finalizado);

        ativos.forEach(j => {
            if(j.casaFora === 'Casa') cCasa++; else cFora++;
            if(fTreinador && j.treinador !== fTreinador) return;
            if(fEscalao && j.escalao !== fEscalao) return;

            const tr = document.createElement('tr');
            if(j.conflito) tr.className = 'row-conflito';
            const isPassado = j.data && j.hora && (agora > new Date(`${j.data}T${j.hora}`));

            tr.innerHTML = `
                <td style="background:${j.cor}; width:6px;"></td>
                <td style="font-weight:bold; color:${j.cor}">${j.treinador}</td>
                <td>${j.competicao || '---'}</td>
                <td>${j.jornada || '---'}</td>
                <td><strong>${j.numJogo || '---'}</strong></td>
                <td>${j.escalao}</td><td>${j.adversario}</td>
                <td>${j.data ? j.data.split('-').reverse().join('/') : '---'} √†s ${j.hora || '--:--'}
                    ${j.conflito ? '<span class="error-tag">‚ö†Ô∏è Conflito Casa (2h)</span>' : ''}
                    ${isPassado ? `<br><button class="btn-finalizar" onclick="finalizarJogoPrompt('${j.id}')">üèÅ Finalizar</button>` : ''}
                </td>
                <td>${j.pavilhao || '---'}</td>
                <td><span class="badge ${j.casaFora === 'Casa' ? 'badge-casa' : 'badge-fora'}">${j.casaFora}</span></td>
                <td><button class="btn-action" onclick="prepararEdicao('${j.id}')">‚úèÔ∏è</button>
                    <button class="btn-action" onclick="eliminarJogo('${j.id}')">üóëÔ∏è</button></td>`;
            lista.appendChild(tr);
        });

        finalizados.forEach(j => {
            cFim++;
            if(fTreinador && j.treinador !== fTreinador) return;
            if(fEscalao && j.escalao !== fEscalao) return;

            const tr = document.createElement('tr');
            tr.className = 'row-finalizado';
            tr.innerHTML = `
                <td style="background:${j.cor}; width:6px;"></td>
                <td style="font-weight:bold;">${j.treinador}</td>
                <td>${j.competicao || '---'}</td>
                <td>${j.jornada || '---'}</td>
                <td><strong>${j.numJogo || '---'}</strong></td>
                <td>${j.escalao}</td>
                <td>
                    ${j.adversario}<br>
                    <span class="resultado-tag">${j.setPro} - ${j.setContra}</span>
                    <span class="parciais-tag">(${j.parciais || 'sem parciais'})</span>
                </td>
                <td>${j.data ? j.data.split('-').reverse().join('/') : '---'} √†s ${j.hora || '--:--'}</td>
                <td>${j.pavilhao || '---'}</td>
                <td><span class="badge badge-finalizado">Finalizado</span></td>
                <td><button class="btn-action" onclick="prepararEdicao('${j.id}')">‚úèÔ∏è</button>
                    <button class="btn-action" onclick="eliminarJogo('${j.id}')">üóëÔ∏è</button></td>`;
            listaHistorico.appendChild(tr);
        });

        document.getElementById('statTotal').innerText = ativos.length + cFim;
        document.getElementById('statCasa').innerText = cCasa;
        document.getElementById('statFora').innerText = cFora;
        document.getElementById('statFim').innerText = cFim;
    };

    window.prepararEdicao = (id) => {
        const j = jogosAtuais.find(x => x.id === id);
        document.getElementById('treinador').value = j.treinador;
        document.getElementById('cor').value = j.cor;
        document.getElementById('casaFora').value = j.casaFora;
        document.getElementById('data').value = j.data;
        document.getElementById('hora').value = j.hora;
        document.getElementById('competicao').value = j.competicao || '';
        document.getElementById('jornada').value = j.jornada || '';
        document.getElementById('numJogo').value = j.numJogo || '';
        document.getElementById('escalao').value = j.escalao;
        document.getElementById('adversario').value = j.adversario;
        document.getElementById('pavilhao').value = j.pavilhao;
        
        document.getElementById('boxSetPro').style.display = 'block';
        document.getElementById('boxSetContra').style.display = 'block';
        document.getElementById('boxParciais').style.display = 'block';
        document.getElementById('setPro').value = j.setPro || 0;
        document.getElementById('setContra').value = j.setContra || 0;
        document.getElementById('parciais').value = j.parciais || '';
        
        editId = id; window.scrollTo(0,0);
    };

    window.eliminarJogo = async (id) => {
        if (prompt("Senha para eliminar:") === "academicos2026") await deleteDoc(doc(db, "jogos", id));
    };

    function limpar() { ['data','hora','competicao','jornada','numJogo','adversario','pavilhao','setPro', 'setContra', 'parciais'].forEach(id => document.getElementById(id).value = ''); }
</script>
</body>
</html>
